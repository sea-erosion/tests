<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>港湾監視記録｜非公開</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #05070a;
      overflow: hidden;
      font-family: "Courier New", monospace;
      color: #9fb3c8;
    }

    #overlay {
      position: fixed;
      bottom: 20px;
      left: 20px;
      font-size: 12px;
      opacity: 0.85;
      pointer-events: none;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="overlay">
  <div>PORT AUTHORITY :: MONITORING NODE</div>
  <div id="status">状態：安定</div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let w, h;
let time = 0;
let instability = 0;

function resize() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

// ノイズ生成
function drawNoise(alpha) {
  const imageData = ctx.createImageData(w, h);
  for (let i = 0; i < imageData.data.length; i += 4) {
    const v = Math.random() * 255;
    imageData.data[i] = v;
    imageData.data[i+1] = v;
    imageData.data[i+2] = v;
    imageData.data[i+3] = alpha;
  }
  ctx.putImageData(imageData, 0, 0);
}

// 海蝕っぽい歪み
function drawDistortion() {
  ctx.save();
  ctx.globalAlpha = 0.15 + instability * 0.3;
  ctx.strokeStyle = "#1a3b5f";

  for (let i = 0; i < 50; i++) {
    ctx.beginPath();
    let y = (i / 50) * h;
    for (let x = 0; x < w; x += 20) {
      const offset = Math.sin((x + time * 50) * 0.01 + y * 0.02) * (10 + instability * 30);
      ctx.lineTo(x, y + offset);
    }
    ctx.stroke();
  }
  ctx.restore();
}

function render() {
  ctx.clearRect(0, 0, w, h);

  // 背景
  ctx.fillStyle = "#05070a";
  ctx.fillRect(0, 0, w, h);

  drawDistortion();
  drawNoise(20 + instability * 40);

  time += 0.01;
  requestAnimationFrame(render);
}

render();

// インタラクション：不安定化
document.addEventListener("click", () => {
  instability += 0.1;
  document.getElementById("status").textContent =
    instability > 0.5 ? "状態：不安定" : "状態：監視中";
});

// 隠し入力（ARGトリガー）
let buffer = "";
document.addEventListener("keydown", e => {
  buffer += e.key.toLowerCase();
  if (buffer.includes("kaishoku")) {
    document.getElementById("status").textContent =
      "警告：未認可アクセス検知";
    instability = 1;
  }
  if (buffer.length > 20) buffer = buffer.slice(-20);
});
</script>

</body>
</html>
